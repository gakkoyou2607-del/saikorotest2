<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>パスワードつき Python 実行</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        #main { display: none; margin-top: 20px; }
        #output { background: #eee; padding: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>

<h2>パスワードを入力</h2>
<input type="password" id="pw">
<button onclick="checkPw()">入る</button>

<div id="main">
    <h2>サイコロ</h2>
    <button id="runBtn" disabled>▶ 実行</button>
    <pre id="output"></pre>
</div>

<script>
let pyodideReady = loadPyodide();
let pyodideLoaded = false;

// Pyodide ロード完了
pyodideReady.then(() => {
    pyodideLoaded = true;
    document.getElementById("runBtn").disabled = false;
});

function checkPw() {
    const pw = document.getElementById("pw").value;
    if (pw === "playlogic") {
        document.getElementById("main").style.display = "block";
    } else {
        alert("パスワードが違います");
    }
}

async function runPython() {
    if (!pyodideLoaded) {
        alert("まだ読み込み中です。1〜2秒待ってください。");
        return;
    }

    const pyodide = await pyodideReady;

    document.getElementById("output").textContent = "--- 実行開始 ---\n";

    pyodide.setStdout(s => {
        document.getElementById("output").textContent += s + "\n";
    });

    pyodide.setStdin(() => prompt("入力してください："));

    let code = `
import random

a = random.randrange(2, 6)

i = 1
while i == 1:
    print(a)
    b = 0
    while b == 0:
        n = input("1. 続ける 2. 終わる (1か2の数字を入れてね): ")
        if n == "1":
            b = 1
        elif n == "2":
            print("終了")
            i = 0
            b = 1
        else:
            print("有効じゃありません")
            b = 0
`;

    await pyodide.runPythonAsync(code);
}

document.getElementById("runBtn").onclick = runPython;
</script>

</body>
</html>

